#!/usr/bin/env ruby
require_relative '../lib/mdl'

require 'optparse'
require 'kramdown'

options = {
  :verbose => false
}
OptionParser.new do |opts|
  opts.banner = "Usage: mdl.rb [options]"

  opts.on("-v", "--[no-]verbose", "Increase verbosity") do |v|
    options[:verbose] = v
  end
end.parse!

rules = MarkdownLint::RuleSet.load(File.join(File.dirname(__FILE__), "../lib/mdl/rules.rb"))

ARGV.each do |filename|
  doc = MarkdownLint::Doc.new(filename)
  doc.parsed.warnings.each do |w|
    puts "#{filename}: Kramdown Warning: #{w}"
  end
  rules.each do |rule|
    error_lines = rule.check.call(doc)
    next unless error_lines
    error_lines.each do |line|
      puts "#{filename}:#{line}: #{rule.id} #{rule.description}"
    end
  end
end
